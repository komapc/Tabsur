events {
    worker_connections 1024;
}

http {
    upstream backend {
        server tabsur-server:5000;
    }

    server {
        listen 80;
        server_name _;

        # Health check endpoint
        location /health {
            access_log off;
            return 200 "healthy\n";
            add_header Content-Type text/plain;
        }

        # API endpoints
        location /api/ {
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # Timeout settings
            proxy_connect_timeout 30s;
            proxy_send_timeout 30s;
            proxy_read_timeout 30s;
        }

        # Admin interface - simple version
        location / {
            return 200 '<!DOCTYPE html><html><head><title>Admin Panel</title><style>body{font-family:Arial;margin:40px;background:#f5f5f5}.container{max-width:800px;margin:0 auto;background:white;padding:30px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1)}h1{color:#333;text-align:center}.card{padding:20px;border:1px solid #ddd;border-radius:5px;margin:20px 0;background:#f9f9f9}.status{padding:10px;border-radius:5px;margin:10px 0}.success{background:#d4edda;color:#155724}.error{background:#f8d7da;color:#721c24}.warning{background:#fff3cd;color:#856404}.btn{background:#007bff;color:white;border:none;padding:10px 20px;border-radius:5px;cursor:pointer;margin:5px}.btn:hover{background:#0056b3}</style></head><body><div class="container"><h1>üöÄ Tabsur Admin Panel</h1><div class="card"><h2>üìä System Status</h2><div id="server-status" class="status">Checking...</div><div id="db-status" class="status">Checking...</div><button class="btn" onclick="checkAll()">Refresh All</button></div><div class="card"><h2>üîå API Endpoints</h2><ul><li><code>/api/system/health</code> - System health</li><li><code>/api/users/:id</code> - User info</li><li><code>/api/meals</code> - Meals</li></ul></div></div><script>function checkAll(){checkServer();checkDB()}async function checkServer(){try{const r=await fetch("/health");const s=document.getElementById("server-status");if(r.ok){s.textContent="‚úÖ Server running";s.className="status success"}else{s.textContent="‚ùå Server error";s.className="status error"}}catch(e){document.getElementById("server-status").textContent="‚ùå Server unreachable";document.getElementById("server-status").className="status error"}}async function checkDB(){try{const r=await fetch("/api/system/health");const d=await r.json();const s=document.getElementById("db-status");if(d.DB==="connected"){s.textContent="‚úÖ Database connected";s.className="status success"}else if(d.DB==="checking"){s.textContent="‚ö†Ô∏è Database checking";s.className="status warning"}else{s.textContent="‚ùå Database disconnected";s.className="status error"}}catch(e){document.getElementById("db-status").textContent="‚ùå Cannot check DB";document.getElementById("db-status").className="status error"}}document.addEventListener("DOMContentLoaded",checkAll);</script></body></html>';
            add_header Content-Type text/html;
        }
    }
}
