{"version":3,"names":["_getJestObj","mock","connect","jest","fn","mockResolvedValue","query","release","genSalt","hash","compare","require","request","express","bodyParser","users","app","use","urlencoded","extended","json","describe","testUser","beforeEach","name","email","password","password2","location","address","it","pool","mockClient","mockResolvedValueOnce","rows","id","response","post","send","expect","status","toBe","toHaveBeenCalledWith","stringContaining","arrayContaining","any","String","body","toBeDefined"],"sources":["auth.test.js"],"sourcesContent":["const request = require('supertest');\nconst express = require('express');\nconst bodyParser = require('body-parser');\n\n// Import your routes\nconst users = require('../routes/api/users');\n\n// Mock the database\njest.mock('../routes/db.js', () => ({\n  connect: jest.fn().mockResolvedValue({\n    query: jest.fn(),\n    release: jest.fn()\n  })\n}));\n\nconst app = express();\napp.use(bodyParser.urlencoded({ extended: false }));\napp.use(bodyParser.json());\n\n// Mock bcrypt\njest.mock('bcryptjs', () => ({\n  genSalt: jest.fn().mockResolvedValue('mocksalt'),\n  hash: jest.fn().mockResolvedValue('mockhash'),\n  compare: jest.fn().mockResolvedValue(true)\n}));\napp.use('/api/users', users);\n\ndescribe('Authentication API', () => {\n  let testUser;\n\n  beforeEach(() => {\n    testUser = {\n      name: 'Test User',\n      email: 'test@example.com',\n      password: 'password123',\n      password2: 'password123', // API expects password2\n      location: '40.7128,-74.0060', // New York coordinates\n      address: '123 Test Street, New York, NY'\n    };\n  });\n\n  describe('POST /api/users/register', () => {\n    it('should register a new user with valid data', async () => {\n      const pool = require('../routes/db.js');\n      const mockClient = await pool.connect();\n\n      // Mock successful registration\n      mockClient.query.mockResolvedValueOnce({\n        rows: [{ id: 1, ...testUser }]\n      });\n\n      const response = await request(app)\n        .post('/api/users/register')\n        .send(testUser);\n\n      expect(response.status).toBe(201);\n      expect(mockClient.query).toHaveBeenCalledWith(\n        expect.stringContaining('INSERT INTO users'),\n        expect.arrayContaining([\n          testUser.name,\n          testUser.email,\n          expect.any(String), // hashed password\n          expect.any(String), // location\n          testUser.address\n        ])\n      );\n    });\n\n    it('should reject registration with invalid email', async () => {\n      testUser.email = 'invalid-email';\n\n      const response = await request(app)\n        .post('/api/users/register')\n        .send(testUser);\n\n      expect(response.status).toBe(400);\n      expect(response.body.email).toBeDefined();\n    });\n\n    it('should reject registration with mismatched passwords', async () => {\n      testUser.password2 = 'different-password';\n\n      const response = await request(app)\n        .post('/api/users/register')\n        .send(testUser);\n\n      expect(response.status).toBe(400);\n      expect(response.body.password2).toBeDefined();\n    });\n\n    it('should reject registration with short password', async () => {\n      testUser.password = '123';\n      testUser.password2 = '123';\n\n      const response = await request(app)\n        .post('/api/users/register')\n        .send(testUser);\n\n      expect(response.status).toBe(400);\n      expect(response.body.password).toBeDefined();\n    });\n  });\n\n  describe('POST /api/users/login', () => {\n    it('should login with valid credentials', async () => {\n      const pool = require('../routes/db.js');\n      const mockClient = await pool.connect();\n\n      // Mock user found in database\n      mockClient.query.mockResolvedValueOnce({\n        rows: [{\n          id: 1,\n          email: testUser.email,\n          password: '$2a$10$mockHashedPassword', // This would be a real bcrypt hash\n          name: testUser.name\n        }]\n      });\n\n      // Mock bcrypt comparison (would need to mock bcrypt module)\n      const response = await request(app)\n        .post('/api/users/login')\n        .send({\n          email: testUser.email,\n          password: testUser.password\n        });\n\n      // Note: This test may fail due to bcrypt, but shows the structure\n      expect(mockClient.query).toHaveBeenCalledWith(\n        expect.stringContaining('SELECT'),\n        [testUser.email]\n      );\n    });\n\n    it('should reject login with invalid email', async () => {\n      const response = await request(app)\n        .post('/api/users/login')\n        .send({\n          email: 'invalid-email',\n          password: testUser.password\n        });\n\n      expect(response.status).toBe(400);\n      expect(response.body.email).toBeDefined();\n    });\n\n    it('should reject login with empty password', async () => {\n      const response = await request(app)\n        .post('/api/users/login')\n        .send({\n          email: testUser.email,\n          password: ''\n        });\n\n      expect(response.status).toBe(400);\n      expect(response.body.password).toBeDefined();\n    });\n  });\n});"],"mappings":"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","ignoreList":[]}