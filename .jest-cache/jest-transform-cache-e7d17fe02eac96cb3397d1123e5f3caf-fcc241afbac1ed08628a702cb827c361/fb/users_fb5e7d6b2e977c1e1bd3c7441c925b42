087c5844d0267357dfabc651ce6ae77f
"use strict";

const express = require('express');
const router = express.Router();
const bcrypt = require('bcryptjs');
const jwt = require('jsonwebtoken');
const keys = require('../../config/keys');
//const passport = require('passport');
const insertImageIntoDB = require('./utility.js');
const pool = require('../db.js');
// Load input validation;
const validateRegisterInput = require('../../validation/register');
const validateLoginInput = require('../../validation/login');
// Load User model;
//const User = require('../../models/User');
// @route POST api/users/register;
// @desc Register user;
// @access Public;
router.post('/register', async (req, response) => {
  const {
    errors,
    isValid
  } = validateRegisterInput(req.body);
  const input = req.body;
  // Check validation;
  if (!isValid) {
    console.error(`Invalid input: ${JSON.stringify(errors)}`);
    return response.status(400).json(errors);
  }
  try {
    console.log('register.');
    const newUser = req.body;
    const client = await pool.connect();
    console.log('connected');
    bcrypt.genSalt(10, async (err, salt) => {
      bcrypt.hash(input.password, salt, async (err, hash) => {
        if (err) {
          console.error(`bcrypt failed: ${JSON.stringify(err)}.`);
          throw err;
        }
        client.query(`INSERT INTO users (name, email, password, location, address)
        VALUES ($1, $2, $3, $4, $5)`, [newUser.name, newUser.email, hash, newUser.location, newUser.address]).then(user => {
          return response.status(201).json(user);
        }).catch(err => {
          console.error(`Insert query failed: ${JSON.stringify(err)}`);
          // Check if it's a duplicate email error
          if (err.code === '23505' && err.constraint === 'unique_user_email') {
            return response.status(400).json({
              email: 'Email already exists'
            });
          }
          return response.status(500).json({
            error: 'Registration failed'
          });
        }).finally(() => {
          client.release();
        });
      });
    });
  } catch (e) {
    console.log('exception catched: ' + e);
    return response.status(500).json(req.body);
  }
});
// @route POST api/users/login;
// @desc Login user and return JWT token;
// @access Public;
router.post('/login', async (req, response) => {
  // Form validation;
  const newReq = req.body;
  const {
    errors,
    isValid
  } = validateLoginInput(req.body);
  if (!isValid) {
    console.log(`Invalid input: ${JSON.stringify(errors)}.`);
    return response.status(400).json(errors);
  }
  console.log(`Login: ${newReq.email}.`);
  const client = await pool.connect();
  client.query('SELECT id, name, password FROM users WHERE email = $1 OR id = $2 LIMIT 1', [newReq.email, newReq.id]).then(res => {
    // no record found
    if (res.rows === undefined || res.rows.length === 0) {
      console.error(`error: user [${newReq.email}] doesn't exist.`);
      errors.email = 'email not found';
      return response.status(500).json(errors);
    }
    // Check password;
    const row = res.rows[0];
    console.log('res: ' + JSON.stringify(res));
    console.log('row: ' + JSON.stringify(row));
    bcrypt.compare(newReq.password, row.password).then(isMatch => {
      if (isMatch) {
        // User matched;
        // Create JWT Payload;
        const payload = {
          id: row.id,
          name: row.name
        };
        // Sign token;
        jwt.sign(payload, keys.secretOrKey, {
          expiresIn: 31556926 // 1 year in seconds
        }, (err, token) => {
          response.json({
            success: true,
            token: 'Bearer ' + token
          });
        });
      } else {
        return response.status(400).json({
          passwordincorrect: 'Password incorrect'
        });
      }
    }).catch(err => {
      console.error('bcrypt error:' + err);
      return response.status(500).json(newReq);
    }).finally(() => client.release());
  });
});
//add avatar path to images and update user_images table;
const addAvatar = async (client, userId, picture) => {
  console.log(`Add avatar: ${JSON.stringify(picture)}`);
  const query = `
  INSERT INTO user_images
  (image_id, user_id)
  SELECT $1, $2
  WHERE
  NOT EXISTS (
  SELECT id FROM user_images WHERE image_id = $1 and user_id=$2
  )`;
  const url = picture.data.url;
  return insertImageIntoDB(url, userId).then(newImageId => {
    console.log(`Add avatar got a image id ${newImageId}.`);
    if (newImageId > 0) {
      return client.query(query, [newImageId, userId]).finally(() => {
        client.release();
      });
    } else {
      console.error(`Add avatar got a negative image id ${newImageId}.`);
    }
  }).catch(err => {
    console.error(`Add avatar error: ${err}.`);
  });
};
// @route POST api/users/loginFB;
// @desc Login user and return JWT token;
// @access Public;
router.post('/loginFB', async (req, response) => {
  // Form validation;
  const newReq = req.body;
  if (!newReq || !newReq.name) {
    console.error(`Bad request to login with facebook: ${JSON.stringify(newReq)}`);
    return response.status(403);
  }
  let newUserId = -1;
  const newUserName = newReq.name;
  console.log(`Login with facebook: ${JSON.stringify(newReq)}`);
  const client = await pool.connect();
  client.query('SELECT * FROM users WHERE email = $1 LIMIT 1', [newReq.email]).then(res => {
    // no record found, new FB user
    if (res.rows === undefined || res.rows.length === 0) {
      console.log(`fb user doesn't exist (${newReq.email}), adding to the DB`);
      const addUserQuery = `INSERT INTO users (name, email, password, location, address)
      VALUES ($1, $2, $3, $4, $5) RETURNING id`;
      return client.query(addUserQuery, [newReq.name, newReq.email, newReq.accessToken, '(0,0)', '']).then(user => {
        // return response.status(201).json(user);
        console.log(`New record created: ${JSON.stringify(user)}`);
        newUserId = user;
      }).catch(err => {
        console.error(`Inserting user failed:  ${err}`);
        return response.status(500).json(err);
      }).finally(() => {
        // client.release();
      });
    } else {
      newUserId = res.rows[0].id;
      console.log(`Known user logged-in via fb: ${newReq.email}`);
    }
    // Check password;
    // const row = res.rows[0];
    const payload = {
      id: newUserId,
      name: newUserName
    };
    // Sign token;
    jwt.sign(payload, keys.secretOrKey, {
      expiresIn: 31556926 // 1 year in seconds
    }, (err, token) => {
      response.json({
        success: true,
        token: 'Bearer ' + token
      });
    });
  }).catch(err => {
    console.error('fb user error:' + err);
    return response.status(500).json(newReq);
  }).finally(async () => {
    await addAvatar(client, newUserId, newReq.picture);
    client.release();
  });
});
// @route GET api/users;
// @desc get public user properties;
// @access Public;
router.get('/:id', async (req, response) => {
  // Find the user;
  const client = await pool.connect();
  // .catch(err => {
  //   console.error(err);
  //   return response.status(500).json(err);
  // });
  return client.query(`
  SELECT
  id,
  name,
  100 AS rate,
  (SELECT COUNT (1) FROM meals WHERE host_id = $1) AS meals_created,
  (SELECT count(1) AS following FROM follow WHERE follower=$1),
  (SELECT count(1) AS followers FROM follow WHERE followie=$1),
  (SELECT COUNT (1) FROM meals WHERE host_id = $1 AND date > CURRENT_TIMESTAMP) AS active_meals
  FROM users WHERE id = $1
  `, [req.params.id]).then(user => {
    response.json(user.rows);
  }).catch(err => {
    console.error(err);
    return response.status(500).json('No user');
  }).finally(() => {
    client.release();
  });
});
module.exports = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsImJjcnlwdCIsImp3dCIsImtleXMiLCJpbnNlcnRJbWFnZUludG9EQiIsInBvb2wiLCJ2YWxpZGF0ZVJlZ2lzdGVySW5wdXQiLCJ2YWxpZGF0ZUxvZ2luSW5wdXQiLCJwb3N0IiwicmVxIiwicmVzcG9uc2UiLCJlcnJvcnMiLCJpc1ZhbGlkIiwiYm9keSIsImlucHV0IiwiY29uc29sZSIsImVycm9yIiwiSlNPTiIsInN0cmluZ2lmeSIsInN0YXR1cyIsImpzb24iLCJsb2ciLCJuZXdVc2VyIiwiY2xpZW50IiwiY29ubmVjdCIsImdlblNhbHQiLCJlcnIiLCJzYWx0IiwiaGFzaCIsInBhc3N3b3JkIiwicXVlcnkiLCJuYW1lIiwiZW1haWwiLCJsb2NhdGlvbiIsImFkZHJlc3MiLCJ0aGVuIiwidXNlciIsImNhdGNoIiwiY29kZSIsImNvbnN0cmFpbnQiLCJmaW5hbGx5IiwicmVsZWFzZSIsImUiLCJuZXdSZXEiLCJpZCIsInJlcyIsInJvd3MiLCJ1bmRlZmluZWQiLCJsZW5ndGgiLCJyb3ciLCJjb21wYXJlIiwiaXNNYXRjaCIsInBheWxvYWQiLCJzaWduIiwic2VjcmV0T3JLZXkiLCJleHBpcmVzSW4iLCJ0b2tlbiIsInN1Y2Nlc3MiLCJwYXNzd29yZGluY29ycmVjdCIsImFkZEF2YXRhciIsInVzZXJJZCIsInBpY3R1cmUiLCJ1cmwiLCJkYXRhIiwibmV3SW1hZ2VJZCIsIm5ld1VzZXJJZCIsIm5ld1VzZXJOYW1lIiwiYWRkVXNlclF1ZXJ5IiwiYWNjZXNzVG9rZW4iLCJnZXQiLCJwYXJhbXMiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsidXNlcnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5jb25zdCBiY3J5cHQgPSByZXF1aXJlKCdiY3J5cHRqcycpO1xuY29uc3Qgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7XG5jb25zdCBrZXlzID0gcmVxdWlyZSgnLi4vLi4vY29uZmlnL2tleXMnKTtcbi8vY29uc3QgcGFzc3BvcnQgPSByZXF1aXJlKCdwYXNzcG9ydCcpO1xuY29uc3QgaW5zZXJ0SW1hZ2VJbnRvREIgPSByZXF1aXJlKCcuL3V0aWxpdHkuanMnKTtcbmNvbnN0IHBvb2wgPSByZXF1aXJlKCcuLi9kYi5qcycpO1xuLy8gTG9hZCBpbnB1dCB2YWxpZGF0aW9uO1xuY29uc3QgdmFsaWRhdGVSZWdpc3RlcklucHV0ID0gcmVxdWlyZSgnLi4vLi4vdmFsaWRhdGlvbi9yZWdpc3RlcicpO1xuY29uc3QgdmFsaWRhdGVMb2dpbklucHV0ID0gcmVxdWlyZSgnLi4vLi4vdmFsaWRhdGlvbi9sb2dpbicpO1xuLy8gTG9hZCBVc2VyIG1vZGVsO1xuLy9jb25zdCBVc2VyID0gcmVxdWlyZSgnLi4vLi4vbW9kZWxzL1VzZXInKTtcbi8vIEByb3V0ZSBQT1NUIGFwaS91c2Vycy9yZWdpc3Rlcjtcbi8vIEBkZXNjIFJlZ2lzdGVyIHVzZXI7XG4vLyBAYWNjZXNzIFB1YmxpYztcbnJvdXRlci5wb3N0KCcvcmVnaXN0ZXInLCBhc3luYyAocmVxLCByZXNwb25zZSkgPT4ge1xuICBjb25zdCB7IGVycm9ycywgaXNWYWxpZCB9ID0gdmFsaWRhdGVSZWdpc3RlcklucHV0KHJlcS5ib2R5KTtcbiAgY29uc3QgaW5wdXQgPSByZXEuYm9keTtcbiAgLy8gQ2hlY2sgdmFsaWRhdGlvbjtcbiAgaWYgKCFpc1ZhbGlkKSB7XG4gICAgY29uc29sZS5lcnJvcihgSW52YWxpZCBpbnB1dDogJHtKU09OLnN0cmluZ2lmeShlcnJvcnMpfWApO1xuICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNDAwKS5qc29uKGVycm9ycyk7XG4gIH1cbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZygncmVnaXN0ZXIuJyk7XG4gICAgY29uc3QgbmV3VXNlciA9IHJlcS5ib2R5O1xuICAgIGNvbnN0IGNsaWVudCA9IGF3YWl0IHBvb2wuY29ubmVjdCgpO1xuICAgIGNvbnNvbGUubG9nKCdjb25uZWN0ZWQnKTtcbiAgICBiY3J5cHQuZ2VuU2FsdCgxMCwgYXN5bmMgKGVyciwgc2FsdCkgPT4ge1xuICAgICAgYmNyeXB0Lmhhc2goaW5wdXQucGFzc3dvcmQsIHNhbHQsIGFzeW5jIChlcnIsIGhhc2gpID0+IHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYGJjcnlwdCBmYWlsZWQ6ICR7SlNPTi5zdHJpbmdpZnkoZXJyKX0uYCk7XG4gICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICB9XG4gICAgICAgIGNsaWVudC5xdWVyeShgSU5TRVJUIElOVE8gdXNlcnMgKG5hbWUsIGVtYWlsLCBwYXNzd29yZCwgbG9jYXRpb24sIGFkZHJlc3MpXG4gICAgICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQsICQ1KWAsXG4gICAgICAgIFtuZXdVc2VyLm5hbWUsIG5ld1VzZXIuZW1haWwsIGhhc2gsIG5ld1VzZXIubG9jYXRpb24sIG5ld1VzZXIuYWRkcmVzc10pXG4gICAgICAgICAgLnRoZW4odXNlciA9PiB7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDIwMSkuanNvbih1c2VyKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgSW5zZXJ0IHF1ZXJ5IGZhaWxlZDogJHtKU09OLnN0cmluZ2lmeShlcnIpfWApO1xuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhIGR1cGxpY2F0ZSBlbWFpbCBlcnJvclxuICAgICAgICAgICAgaWYgKGVyci5jb2RlID09PSAnMjM1MDUnICYmIGVyci5jb25zdHJhaW50ID09PSAndW5pcXVlX3VzZXJfZW1haWwnKSB7XG4gICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNDAwKS5qc29uKHsgZW1haWw6ICdFbWFpbCBhbHJlYWR5IGV4aXN0cycgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnUmVnaXN0cmF0aW9uIGZhaWxlZCcgfSk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgICAgICBjbGllbnQucmVsZWFzZSgpO1xuICAgICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbiAgY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmxvZygnZXhjZXB0aW9uIGNhdGNoZWQ6ICcgKyBlKTtcbiAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDUwMCkuanNvbihyZXEuYm9keSk7XG4gIH1cbn0pO1xuLy8gQHJvdXRlIFBPU1QgYXBpL3VzZXJzL2xvZ2luO1xuLy8gQGRlc2MgTG9naW4gdXNlciBhbmQgcmV0dXJuIEpXVCB0b2tlbjtcbi8vIEBhY2Nlc3MgUHVibGljO1xucm91dGVyLnBvc3QoJy9sb2dpbicsIGFzeW5jIChyZXEsIHJlc3BvbnNlKSA9PiB7XG4gIC8vIEZvcm0gdmFsaWRhdGlvbjtcbiAgY29uc3QgbmV3UmVxID0gcmVxLmJvZHk7XG4gIGNvbnN0IHsgZXJyb3JzLCBpc1ZhbGlkIH0gPSB2YWxpZGF0ZUxvZ2luSW5wdXQocmVxLmJvZHkpO1xuICBpZiAoIWlzVmFsaWQpIHtcbiAgICBjb25zb2xlLmxvZyhgSW52YWxpZCBpbnB1dDogJHtKU09OLnN0cmluZ2lmeShlcnJvcnMpfS5gKTtcbiAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDQwMCkuanNvbihlcnJvcnMpO1xuICB9XG4gIGNvbnNvbGUubG9nKGBMb2dpbjogJHtuZXdSZXEuZW1haWx9LmApO1xuICBjb25zdCBjbGllbnQgPSBhd2FpdCBwb29sLmNvbm5lY3QoKTtcbiAgY2xpZW50LnF1ZXJ5KCdTRUxFQ1QgaWQsIG5hbWUsIHBhc3N3b3JkIEZST00gdXNlcnMgV0hFUkUgZW1haWwgPSAkMSBPUiBpZCA9ICQyIExJTUlUIDEnLFxuICAgIFtuZXdSZXEuZW1haWwsIG5ld1JlcS5pZF0pXG4gICAgLnRoZW4ocmVzID0+IHtcbiAgICAvLyBubyByZWNvcmQgZm91bmRcbiAgICAgIGlmIChyZXMucm93cyA9PT0gdW5kZWZpbmVkIHx8IHJlcy5yb3dzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKGBlcnJvcjogdXNlciBbJHtuZXdSZXEuZW1haWx9XSBkb2Vzbid0IGV4aXN0LmApO1xuICAgICAgICBlcnJvcnMuZW1haWwgPSAnZW1haWwgbm90IGZvdW5kJztcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cyg1MDApLmpzb24oZXJyb3JzKTtcbiAgICAgIH1cbiAgICAgIC8vIENoZWNrIHBhc3N3b3JkO1xuICAgICAgY29uc3Qgcm93ID0gcmVzLnJvd3NbMF07XG4gICAgICBjb25zb2xlLmxvZygncmVzOiAnICsgSlNPTi5zdHJpbmdpZnkocmVzKSk7XG4gICAgICBjb25zb2xlLmxvZygncm93OiAnICsgSlNPTi5zdHJpbmdpZnkocm93KSk7XG4gICAgICBiY3J5cHQuY29tcGFyZShuZXdSZXEucGFzc3dvcmQsIHJvdy5wYXNzd29yZCkudGhlbihpc01hdGNoID0+IHtcbiAgICAgICAgaWYgKGlzTWF0Y2gpIHtcbiAgICAgICAgLy8gVXNlciBtYXRjaGVkO1xuICAgICAgICAvLyBDcmVhdGUgSldUIFBheWxvYWQ7XG4gICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgICAgIGlkOiByb3cuaWQsXG4gICAgICAgICAgICBuYW1lOiByb3cubmFtZVxuICAgICAgICAgIH07XG4gICAgICAgICAgLy8gU2lnbiB0b2tlbjtcbiAgICAgICAgICBqd3Quc2lnbihcbiAgICAgICAgICAgIHBheWxvYWQsXG4gICAgICAgICAgICBrZXlzLnNlY3JldE9yS2V5LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBleHBpcmVzSW46IDMxNTU2OTI2IC8vIDEgeWVhciBpbiBzZWNvbmRzXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgKGVyciwgdG9rZW4pID0+IHtcbiAgICAgICAgICAgICAgcmVzcG9uc2UuanNvbih7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0b2tlbjogJ0JlYXJlciAnICsgdG9rZW5cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICAgICAgICAgIC5zdGF0dXMoNDAwKVxuICAgICAgICAgICAgLmpzb24oeyBwYXNzd29yZGluY29ycmVjdDogJ1Bhc3N3b3JkIGluY29ycmVjdCcgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2JjcnlwdCBlcnJvcjonICsgZXJyKTtcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDUwMCkuanNvbihuZXdSZXEpO1xuICAgICAgICB9KVxuICAgICAgICAuZmluYWxseSgoKSA9PiBjbGllbnQucmVsZWFzZSgpKTtcbiAgICB9KTtcbn0pO1xuLy9hZGQgYXZhdGFyIHBhdGggdG8gaW1hZ2VzIGFuZCB1cGRhdGUgdXNlcl9pbWFnZXMgdGFibGU7XG5jb25zdCBhZGRBdmF0YXIgPSBhc3luYyAoY2xpZW50LCB1c2VySWQsIHBpY3R1cmUpID0+IHtcbiAgY29uc29sZS5sb2coYEFkZCBhdmF0YXI6ICR7SlNPTi5zdHJpbmdpZnkocGljdHVyZSl9YCk7XG4gIGNvbnN0IHF1ZXJ5ID0gYFxuICBJTlNFUlQgSU5UTyB1c2VyX2ltYWdlc1xuICAoaW1hZ2VfaWQsIHVzZXJfaWQpXG4gIFNFTEVDVCAkMSwgJDJcbiAgV0hFUkVcbiAgTk9UIEVYSVNUUyAoXG4gIFNFTEVDVCBpZCBGUk9NIHVzZXJfaW1hZ2VzIFdIRVJFIGltYWdlX2lkID0gJDEgYW5kIHVzZXJfaWQ9JDJcbiAgKWA7XG4gIGNvbnN0IHVybCA9IHBpY3R1cmUuZGF0YS51cmw7XG4gIHJldHVybiBpbnNlcnRJbWFnZUludG9EQih1cmwsIHVzZXJJZClcbiAgICAudGhlbigobmV3SW1hZ2VJZCkgPT4ge1xuICAgICAgY29uc29sZS5sb2coYEFkZCBhdmF0YXIgZ290IGEgaW1hZ2UgaWQgJHtuZXdJbWFnZUlkfS5gKTtcbiAgICAgIGlmIChuZXdJbWFnZUlkID4gMCkge1xuICAgICAgICByZXR1cm4gY2xpZW50LnF1ZXJ5KHF1ZXJ5LCBbbmV3SW1hZ2VJZCwgdXNlcklkXSkuZmluYWxseSgoKSA9PiB7XG4gICAgICAgICAgY2xpZW50LnJlbGVhc2UoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgQWRkIGF2YXRhciBnb3QgYSBuZWdhdGl2ZSBpbWFnZSBpZCAke25ld0ltYWdlSWR9LmApO1xuICAgICAgfVxuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYEFkZCBhdmF0YXIgZXJyb3I6ICR7ZXJyfS5gKTtcbiAgICB9KTtcbn07XG4vLyBAcm91dGUgUE9TVCBhcGkvdXNlcnMvbG9naW5GQjtcbi8vIEBkZXNjIExvZ2luIHVzZXIgYW5kIHJldHVybiBKV1QgdG9rZW47XG4vLyBAYWNjZXNzIFB1YmxpYztcbnJvdXRlci5wb3N0KCcvbG9naW5GQicsIGFzeW5jIChyZXEsIHJlc3BvbnNlKSA9PiB7XG4gIC8vIEZvcm0gdmFsaWRhdGlvbjtcbiAgY29uc3QgbmV3UmVxID0gcmVxLmJvZHk7XG4gIGlmICghbmV3UmVxIHx8ICFuZXdSZXEubmFtZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoYEJhZCByZXF1ZXN0IHRvIGxvZ2luIHdpdGggZmFjZWJvb2s6ICR7SlNPTi5zdHJpbmdpZnkobmV3UmVxKX1gKTtcbiAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDQwMyk7XG4gIH1cbiAgbGV0IG5ld1VzZXJJZCA9IC0xO1xuICBjb25zdCBuZXdVc2VyTmFtZSA9IG5ld1JlcS5uYW1lO1xuICBjb25zb2xlLmxvZyhgTG9naW4gd2l0aCBmYWNlYm9vazogJHtKU09OLnN0cmluZ2lmeShuZXdSZXEpfWApO1xuICBjb25zdCBjbGllbnQgPSBhd2FpdCBwb29sLmNvbm5lY3QoKTtcbiAgY2xpZW50LnF1ZXJ5KCdTRUxFQ1QgKiBGUk9NIHVzZXJzIFdIRVJFIGVtYWlsID0gJDEgTElNSVQgMScsIFtuZXdSZXEuZW1haWxdKVxuICAgIC50aGVuKHJlcyA9PiB7XG4gICAgLy8gbm8gcmVjb3JkIGZvdW5kLCBuZXcgRkIgdXNlclxuICAgICAgaWYgKHJlcy5yb3dzID09PSB1bmRlZmluZWQgfHwgcmVzLnJvd3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBmYiB1c2VyIGRvZXNuJ3QgZXhpc3QgKCR7bmV3UmVxLmVtYWlsfSksIGFkZGluZyB0byB0aGUgREJgKTtcbiAgICAgICAgY29uc3QgYWRkVXNlclF1ZXJ5ID0gYElOU0VSVCBJTlRPIHVzZXJzIChuYW1lLCBlbWFpbCwgcGFzc3dvcmQsIGxvY2F0aW9uLCBhZGRyZXNzKVxuICAgICAgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUpIFJFVFVSTklORyBpZGA7XG4gICAgICAgIHJldHVybiBjbGllbnQucXVlcnkoYWRkVXNlclF1ZXJ5LFxuICAgICAgICAgIFtuZXdSZXEubmFtZSwgbmV3UmVxLmVtYWlsLCBuZXdSZXEuYWNjZXNzVG9rZW4sICcoMCwwKScsICcnXSlcbiAgICAgICAgICAudGhlbih1c2VyID0+IHtcbiAgICAgICAgICAvLyByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDIwMSkuanNvbih1c2VyKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBOZXcgcmVjb3JkIGNyZWF0ZWQ6ICR7SlNPTi5zdHJpbmdpZnkodXNlcil9YCk7XG4gICAgICAgICAgICBuZXdVc2VySWQgPSB1c2VyO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBJbnNlcnRpbmcgdXNlciBmYWlsZWQ6ICAke2Vycn1gKTtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNTAwKS5qc29uKGVycik7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgICAgLy8gY2xpZW50LnJlbGVhc2UoKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBuZXdVc2VySWQgPSByZXMucm93c1swXS5pZDtcbiAgICAgICAgY29uc29sZS5sb2coYEtub3duIHVzZXIgbG9nZ2VkLWluIHZpYSBmYjogJHtuZXdSZXEuZW1haWx9YCk7XG4gICAgICB9XG4gICAgICAvLyBDaGVjayBwYXNzd29yZDtcbiAgICAgIC8vIGNvbnN0IHJvdyA9IHJlcy5yb3dzWzBdO1xuICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgaWQ6IG5ld1VzZXJJZCxcbiAgICAgICAgbmFtZTogbmV3VXNlck5hbWVcbiAgICAgIH07XG4gICAgICAvLyBTaWduIHRva2VuO1xuICAgICAgand0LnNpZ24oXG4gICAgICAgIHBheWxvYWQsXG4gICAgICAgIGtleXMuc2VjcmV0T3JLZXksXG4gICAgICAgIHtcbiAgICAgICAgICBleHBpcmVzSW46IDMxNTU2OTI2IC8vIDEgeWVhciBpbiBzZWNvbmRzXG4gICAgICAgIH0sXG4gICAgICAgIChlcnIsIHRva2VuKSA9PiB7XG4gICAgICAgICAgcmVzcG9uc2UuanNvbih7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgdG9rZW46ICdCZWFyZXIgJyArIHRva2VuXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSlcbiAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ2ZiIHVzZXIgZXJyb3I6JyArIGVycik7XG4gICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDUwMCkuanNvbihuZXdSZXEpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgYWRkQXZhdGFyKGNsaWVudCwgbmV3VXNlcklkLCBuZXdSZXEucGljdHVyZSk7XG4gICAgICBjbGllbnQucmVsZWFzZSgpO1xuICAgIH0pO1xufSk7XG4vLyBAcm91dGUgR0VUIGFwaS91c2Vycztcbi8vIEBkZXNjIGdldCBwdWJsaWMgdXNlciBwcm9wZXJ0aWVzO1xuLy8gQGFjY2VzcyBQdWJsaWM7XG5yb3V0ZXIuZ2V0KCcvOmlkJywgYXN5bmMgKHJlcSwgcmVzcG9uc2UpID0+IHtcbiAgLy8gRmluZCB0aGUgdXNlcjtcbiAgY29uc3QgY2xpZW50ID0gYXdhaXQgcG9vbC5jb25uZWN0KCk7XG4gIC8vIC5jYXRjaChlcnIgPT4ge1xuICAvLyAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgLy8gICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDUwMCkuanNvbihlcnIpO1xuICAvLyB9KTtcbiAgcmV0dXJuIGNsaWVudC5xdWVyeShgXG4gIFNFTEVDVFxuICBpZCxcbiAgbmFtZSxcbiAgMTAwIEFTIHJhdGUsXG4gIChTRUxFQ1QgQ09VTlQgKDEpIEZST00gbWVhbHMgV0hFUkUgaG9zdF9pZCA9ICQxKSBBUyBtZWFsc19jcmVhdGVkLFxuICAoU0VMRUNUIGNvdW50KDEpIEFTIGZvbGxvd2luZyBGUk9NIGZvbGxvdyBXSEVSRSBmb2xsb3dlcj0kMSksXG4gIChTRUxFQ1QgY291bnQoMSkgQVMgZm9sbG93ZXJzIEZST00gZm9sbG93IFdIRVJFIGZvbGxvd2llPSQxKSxcbiAgKFNFTEVDVCBDT1VOVCAoMSkgRlJPTSBtZWFscyBXSEVSRSBob3N0X2lkID0gJDEgQU5EIGRhdGUgPiBDVVJSRU5UX1RJTUVTVEFNUCkgQVMgYWN0aXZlX21lYWxzXG4gIEZST00gdXNlcnMgV0hFUkUgaWQgPSAkMVxuICBgLCBbcmVxLnBhcmFtcy5pZF0pXG4gICAgLnRoZW4odXNlciA9PiB7XG4gICAgICByZXNwb25zZS5qc29uKHVzZXIucm93cyk7XG4gICAgfSlcbiAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNTAwKS5qc29uKCdObyB1c2VyJyk7XG4gICAgfSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBjbGllbnQucmVsZWFzZSgpO1xuICAgIH0pO1xufSk7XG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjsiXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsU0FBUyxDQUFDO0FBQ2xDLE1BQU1DLE1BQU0sR0FBR0YsT0FBTyxDQUFDRyxNQUFNLENBQUMsQ0FBQztBQUMvQixNQUFNQyxNQUFNLEdBQUdILE9BQU8sQ0FBQyxVQUFVLENBQUM7QUFDbEMsTUFBTUksR0FBRyxHQUFHSixPQUFPLENBQUMsY0FBYyxDQUFDO0FBQ25DLE1BQU1LLElBQUksR0FBR0wsT0FBTyxDQUFDLG1CQUFtQixDQUFDO0FBQ3pDO0FBQ0EsTUFBTU0saUJBQWlCLEdBQUdOLE9BQU8sQ0FBQyxjQUFjLENBQUM7QUFDakQsTUFBTU8sSUFBSSxHQUFHUCxPQUFPLENBQUMsVUFBVSxDQUFDO0FBQ2hDO0FBQ0EsTUFBTVEscUJBQXFCLEdBQUdSLE9BQU8sQ0FBQywyQkFBMkIsQ0FBQztBQUNsRSxNQUFNUyxrQkFBa0IsR0FBR1QsT0FBTyxDQUFDLHdCQUF3QixDQUFDO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQUMsTUFBTSxDQUFDUyxJQUFJLENBQUMsV0FBVyxFQUFFLE9BQU9DLEdBQUcsRUFBRUMsUUFBUSxLQUFLO0VBQ2hELE1BQU07SUFBRUMsTUFBTTtJQUFFQztFQUFRLENBQUMsR0FBR04scUJBQXFCLENBQUNHLEdBQUcsQ0FBQ0ksSUFBSSxDQUFDO0VBQzNELE1BQU1DLEtBQUssR0FBR0wsR0FBRyxDQUFDSSxJQUFJO0VBQ3RCO0VB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