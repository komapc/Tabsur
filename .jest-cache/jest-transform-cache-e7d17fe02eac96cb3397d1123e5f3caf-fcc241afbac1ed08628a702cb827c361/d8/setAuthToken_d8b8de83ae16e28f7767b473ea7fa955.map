{"version":3,"names":["_axios","_interopRequireDefault","require","axios","interceptors","request","use","config","console","log","method","toUpperCase","url","headers","auth","Authorization","substring","fullAuth","error","Promise","reject","response","status","size","data","length","message","name","warn","localStorage","removeItem","defaults","common","window","location","pathname","href","setAuthToken","token","authHeader","startsWith","checkAuthState","getItem","localStorageToken","axiosHeaders","authorizationHeader","hasToken","hasHeader","header","exports","runServerSanityCheck","get","clearInvalidAuth","cleanupToken","cleanToken","replace","setItem","_default","default"],"sources":["setAuthToken.js"],"sourcesContent":["import axios from \"axios\";\n\n// Add request interceptor to log all outgoing requests\naxios.interceptors.request.use(\n  (config) => {\n    console.log(\"🚀 Outgoing request:\", {\n      method: config.method?.toUpperCase(),\n      url: config.url,\n      headers: config.headers,\n      auth: config.headers?.Authorization ? `${config.headers.Authorization.substring(0, 20)}...` : 'None',\n      fullAuth: config.headers?.Authorization || 'None'\n    });\n    return config;\n  },\n  (error) => {\n    console.error(\"❌ Request interceptor error:\", error);\n    return Promise.reject(error);\n  }\n);\n\n// Add response interceptor to log all responses\naxios.interceptors.response.use(\n  (response) => {\n    console.log(\"✅ Response received:\", {\n      status: response.status,\n      url: response.config.url,\n      // Do not log full response bodies to avoid leaking data\n      size: typeof response.data === 'string' ? response.data.length : 'object'\n    });\n    return response;\n  },\n  (error) => {\n    console.error(\"❌ Response error:\", {\n      status: error.response?.status,\n      url: error.config?.url,\n      message: error.message,\n      // Redact response payloads\n      data: typeof error.response?.data === 'string' ? `[redacted:${error.response?.data.length}]` : '[redacted]'\n    });\n    \n    // Handle JWT signature errors by clearing invalid tokens\n    if (error.response?.status === 403 && error.response?.data?.name === 'JsonWebTokenError') {\n      console.warn(\"🔐 JWT signature error detected - clearing invalid token\");\n      localStorage.removeItem(\"jwtToken\");\n      delete axios.defaults.headers.common[\"Authorization\"];\n      \n      // Redirect to login if we're not already there\n      if (window.location.pathname !== '/login' && window.location.pathname !== '/') {\n        window.location.href = '/login';\n      }\n    }\n    \n    return Promise.reject(error);\n  }\n);\n\nconst setAuthToken = token => {\n  if (token) {\n    // Apply authorization token to every request if logged in\n    // Check if token already has \"Bearer \" prefix to avoid double prefixing\n    const authHeader = token.startsWith('Bearer ') ? token : `Bearer ${token}`;\n    axios.defaults.headers.common[\"Authorization\"] = authHeader;\n    console.log(\"🔑 Auth token set\");\n  } else {\n    // Delete auth header\n    delete axios.defaults.headers.common[\"Authorization\"];\n    console.log(\"🗑️ Auth token removed\");\n  }\n};\n\n// Function to check current auth state\nexport const checkAuthState = () => {\n  const token = localStorage.getItem(\"jwtToken\");\n  const headers = axios.defaults.headers.common;\n  \n  console.log(\"🔍 Auth State Check:\", {\n    localStorageToken: token ? `${token.substring(0, 20)}...` : 'None',\n    axiosHeaders: headers,\n    authorizationHeader: headers.Authorization || 'None'\n  });\n  \n  return {\n    hasToken: !!token,\n    hasHeader: !!headers.Authorization,\n    token: token,\n    header: headers.Authorization\n  };\n};\n\n// Function to run sanity check on server\nexport const runServerSanityCheck = async () => {\n  try {\n    const response = await axios.get('http://localhost:5000/sanity-check');\n    console.log(\"🔍 Server Sanity Check:\", response.data);\n    return response.data;\n  } catch (error) {\n    console.error(\"❌ Server Sanity Check Failed:\", error);\n    return null;\n  }\n};\n\n// Function to clear invalid authentication\nexport const clearInvalidAuth = () => {\n  console.log(\"🧹 Clearing invalid authentication\");\n  localStorage.removeItem(\"jwtToken\");\n  delete axios.defaults.headers.common[\"Authorization\"];\n  window.location.href = '/login';\n};\n\n// Function to clean up malformed tokens\nexport const cleanupToken = () => {\n  const token = localStorage.getItem(\"jwtToken\");\n  if (token && token.startsWith('Bearer ')) {\n    // Remove the \"Bearer \" prefix if it exists\n    const cleanToken = token.replace('Bearer ', '');\n    localStorage.setItem(\"jwtToken\", cleanToken);\n    console.log(\"🧹 Cleaned up malformed token, removed 'Bearer ' prefix\");\n    return cleanToken;\n  }\n  return token;\n};\n\nexport default setAuthToken;\n"],"mappings":"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","ignoreList":[]}