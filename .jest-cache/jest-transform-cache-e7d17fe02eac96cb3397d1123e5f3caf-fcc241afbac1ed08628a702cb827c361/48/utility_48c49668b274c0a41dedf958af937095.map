{"version":3,"names":["express","require","pool","insertImageIntoDB","imagePath","uploader","console","log","JSON","stringify","isNaN","error","client","connect","query","result","Number","then","res","rows","id","catch","e","finally","release","module","exports"],"sources":["utility.js"],"sourcesContent":["const express = require('express');\nconst pool = require('../db.js');\n\n/// utils\n\nconst insertImageIntoDB = async (imagePath, uploader) => {\n  console.log(`Inserting image [${JSON.stringify(imagePath)}]`);\n  //console.log(`Inserting image [${JSON.stringify(imagePath)}] from user [${JSON.stringify(uploader)}]`);\n  if (isNaN(uploader) || imagePath === '')\n  {\n    console.error(`Cannot insert image: empty data ${imagePath} / ${uploader}.`);\n    return -3;\n  }\n  const client = await pool.connect();\n  const query = `INSERT INTO images (path, status, uploader)\n  VALUES($1, 1, $2) RETURNING id`;\n  console.log(`connected running [${query}]`);\n\n  let  result = '-2';\n  return client.query(query,\n    [imagePath, Number(uploader)])\n    .then(res => {\n      console.log(`insertImageIntoDB: image inserted, id=${JSON.stringify(res.rows[0])}.`);\n      result = res.rows[0].id;\n      return result;\n    })\n    .catch(e => {\n      console.error(`Inserting image into db failed; exception catched: ${e}`);\n      //response.status(500).json(e);\n      result = -1;\n      return result;\n    })\n    .finally(()=>client.release());\n};\n\n\nmodule.exports = insertImageIntoDB;"],"mappings":";;AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMC,IAAI,GAAGD,OAAO,CAAC,UAAU,CAAC;;AAEhC;;AAEA,MAAME,iBAAiB,GAAG,MAAAA,CAAOC,SAAS,EAAEC,QAAQ,KAAK;EACvDC,OAAO,CAACC,GAAG,CAAC,oBAAoBC,IAAI,CAACC,SAAS,CAACL,SAAS,CAAC,GAAG,CAAC;EAC7D;EACA,IAAIM,KAAK,CAACL,QAAQ,CAAC,IAAID,SAAS,KAAK,EAAE,EACvC;IACEE,OAAO,CAACK,KAAK,CAAC,mCAAmCP,SAAS,MAAMC,QAAQ,GAAG,CAAC;IAC5E,OAAO,CAAC,CAAC;EACX;EACA,MAAMO,MAAM,GAAG,MAAMV,IAAI,CAACW,OAAO,CAAC,CAAC;EACnC,MAAMC,KAAK,GAAG;AAChB,iCAAiC;EAC/BR,OAAO,CAACC,GAAG,CAAC,sBAAsBO,KAAK,GAAG,CAAC;EAE3C,IAAKC,MAAM,GAAG,IAAI;EAClB,OAAOH,MAAM,CAACE,KAAK,CAACA,KAAK,EACvB,CAACV,SAAS,EAAEY,MAAM,CAACX,QAAQ,CAAC,CAAC,CAAC,CAC7BY,IAAI,CAACC,GAAG,IAAI;IACXZ,OAAO,CAACC,GAAG,CAAC,yCAAyCC,IAAI,CAACC,SAAS,CAACS,GAAG,CAACC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC;IACpFJ,MAAM,GAAGG,GAAG,CAACC,IAAI,CAAC,CAAC,CAAC,CAACC,EAAE;IACvB,OAAOL,MAAM;EACf,CAAC,CAAC,CACDM,KAAK,CAACC,CAAC,IAAI;IACVhB,OAAO,CAACK,KAAK,CAAC,sDAAsDW,CAAC,EAAE,CAAC;IACxE;IACAP,MAAM,GAAG,CAAC,CAAC;IACX,OAAOA,MAAM;EACf,CAAC,CAAC,CACDQ,OAAO,CAAC,MAAIX,MAAM,CAACY,OAAO,CAAC,CAAC,CAAC;AAClC,CAAC;AAGDC,MAAM,CAACC,OAAO,GAAGvB,iBAAiB","ignoreList":[]}